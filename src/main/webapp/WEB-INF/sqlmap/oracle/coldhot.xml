<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="coldhot">
	<select id="list" resultType="Map" parameterType="Map" timeout="10">
	</select>
	
	<select id="user" resultType="Map" parameterType="Map">
		select 
			USER_SEQ
		from USERS
		where USER_ID = #{USER_ID}
	</select>
	
	<select id="read" resultType="Map" parameterType="Map">
		select 
			USER_SEQ
			, COLD_HOT_DATE
			, COLD_HOT_FLAG
		from COLD_HOT
		where USER_SEQ = #{USER_SEQ}
		and COLD_HOT_DATE = to_char(sysdate,'YY/MM/DD')
	</select>

	<insert id="merge" parameterType="Map">
		<selectKey keyProperty="USER_SEQ" resultType="String" order="AFTER">	<!-- order="BEFORE" --> 
			SELECT USER_SEQ
			FROM USERS
			WHERE USER_SEQ = #{USER_SEQ}
		</selectKey>
	    <!--selectKey resultType="String" keyProperty="MEMBER_SEQ" order="AFTER">
			SELECT MEMBER_SEQ
			FROM CIP_MEMBER
			WHERE MEMBER_SEQ = #{MEMBER_SEQ}
		</selectKey-->
	
		MERGE INTO COLD_HOT C1
		     USING (SELECT #{USER_SEQ} AS USER_SEQ, to_char(sysdate,'YY/MM/DD') AS COLD_HOT_DATE FROM DUAL) U2
		        ON (C1.USER_SEQ = U2.USER_SEQ AND C1.COLD_HOT_DATE = U2.COLD_HOT_DATE)
		 WHEN MATCHED THEN
		    UPDATE SET
				COLD_HOT_FLAG = #{COLD_HOT_FLAG}
		 WHEN NOT MATCHED THEN
		    INSERT (
				USER_SEQ
				, COLD_HOT_DATE
				, COLD_HOT_FLAG
			)
			values(
				#{USER_SEQ}
				, sysdate
				, #{COLD_HOT_FLAG}
			)
	</insert>

	<insert id="insert" parameterType="Map">
	</insert>

	<update id="update" parameterType="Map">
	</update>
	
	<update id="viewup" parameterType="Map">
	</update>

	<delete id="delete" parameterType="Map">
	</delete>
</mapper>